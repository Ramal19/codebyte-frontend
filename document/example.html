<!-- <!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>Paylaşımlar</title>
    <style>
        #posts {
            min-height: 100vh;
            background-color: lightblue;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 10px;
        }

        .post-card {
            width: 200px;
            border: 1px solid #ccc;
            background-color: #fff;
            cursor: pointer;
            text-align: center;
            padding: 5px;
        }

        .post-card img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }

        .post-card p {
            margin: 5px 0;
            font-size: 14px;
        }

        .post-card button {
            margin-top: 5px;
            padding: 3px 5px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <h1>Paylaşımlar</h1>

    <div id="authActions">
        <input type="file" id="videoInput" accept="video/*">
        <input type="file" id="coverInput" accept="image/*">
        <input type="text" id="textInput" placeholder="Yazını daxil et">
        <button id="uploadBtn">Paylaş</button>
        <button id="logoutBtn">Çıxış</button>
    </div>

    <div id="posts"></div>

    <script>
        const token = localStorage.getItem("token");
        if (!token) {
            alert("Əvvəlcə login olmalısınız");
            window.location.href = "login.html";
        }

        const postsDiv = document.getElementById("posts");

        function parseJwt(t) {
            return JSON.parse(atob(t.split('.')[1]));
        }

        async function loadPosts() {
            const res = await fetch("http://localhost:3000/posts");
            const posts = await res.json();
            postsDiv.innerHTML = "";

            posts.reverse().forEach(p => {
                const div = document.createElement("div");
                div.className = "post-card";
                div.innerHTML = `
          <p><b>${p.username}</b></p>
          <p>${p.text}</p>
          <img src="http://localhost:3000/uploads/${p.cover}" alt="Qapaq şəkil">
        `;

                div.onclick = () => {
                    const videoWindow = window.open("", "_blank");
                    videoWindow.document.write(`
            <video src="http://localhost:3000/uploads/${p.video}" controls autoplay style="width:100%; height:auto;"></video>
          `);
                };

                const me = parseJwt(token).username;
                if (p.username === me) {
                    const btn = document.createElement("button");
                    btn.textContent = "Sil";
                    btn.onclick = (e) => {
                        e.stopPropagation();
                        deletePost(p.id);
                    };
                    div.appendChild(btn);
                }

                postsDiv.appendChild(div);
            });
        }

        // async function deletePost(id) {
        //   await fetch(`http://localhost:3000/posts/${id}`, {
        //     method: "DELETE",
        //     headers: { "Authorization": "Bearer " + token }
        //   });
        //   loadPosts();
        // }

        async function deletePost(id) {
            try {
                const res = await fetch(`http://localhost:3000/posts/${id}`, {
                    method: "DELETE",
                    headers: {
                        "Authorization": "Bearer " + token
                    }
                });

                if (!res.ok) {
                    const err = await res.json();
                    alert("Xəta: " + (err.message || "Post silinə bilmədi"));
                    return;
                }

                loadPosts(); // Postlar yenidən yüklənir
            } catch (error) {
                console.error(error);
                alert("Server ilə əlaqə alınmadı");
            }
        }

        document.getElementById("uploadBtn").addEventListener("click", async () => {
            const video = document.getElementById("videoInput").files[0];
            const cover = document.getElementById("coverInput").files[0];
            const text = document.getElementById("textInput").value;

            if (!video) return alert("Video seçin");
            if (!cover) return alert("Qapaq şəkil seçin");
            if (!text) return alert("Text yaz");

            const formData = new FormData();
            formData.append("video", video);
            formData.append("cover", cover);
            formData.append("text", text);

            await fetch("http://localhost:3000/posts", {
                method: "POST",
                headers: { "Authorization": "Bearer " + token },
                body: formData
            });

            loadPosts();
        });

        document.getElementById("logoutBtn").onclick = () => {
            localStorage.removeItem("token");
            location.href = "login.html";
        };

        loadPosts();
    </script>
</body>

</html> -->

<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Kurs Videoları</title>
  <style>
    body {
      display: flex;
      margin: 0;
      font-family: Arial, sans-serif;
      height: 100vh;
    }

    #videoPlayer {
      flex: 3;
      background: #000;
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
      padding: 10px;
    }

    #videoPlayer video {
      width: 100%;
      max-height: 90%;
    }

    #videoList {
      flex: 1;
      background: #f4f4f4;
      overflow-y: auto;
      padding: 10px;
      border-left: 1px solid #ccc;
    }

    .video-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
      cursor: pointer;
      padding: 5px;
      border: 1px solid transparent;
    }

    .video-item:hover {
      border: 1px solid #888;
      background: #e0e0e0;
    }

    .video-item img {
      width: 60px;
      height: 40px;
      object-fit: cover;
      margin-right: 10px;
    }

    .video-item span {
      font-size: 14px;
    }
  </style>
</head>
<body>

  

  <div id="videoPlayer">
    <video id="mainVideo" controls>
      <source id="mainSource" src="" type="video/mp4">
      Video oynatılamır.
    </video>
  </div>

  <div id="videoList"></div>

  <script>
    const token = localStorage.getItem("token");

    const mainVideo = document.getElementById("mainVideo");
    const mainSource = document.getElementById("mainSource");
    const videoListDiv = document.getElementById("videoList");

    async function loadVideos() {
      const res = await fetch("http://localhost:3000/posts", {
        headers: token ? { "Authorization": "Bearer " + token } : {}
      });
      const videos = await res.json();

      videoListDiv.innerHTML = "";

      videos.reverse().forEach(v => {
        const div = document.createElement("div");
        div.className = "video-item";
        div.innerHTML = `
          <img src="http://localhost:3000/uploads/${v.cover}" alt="Qapaq şəkil">
          <span>${v.text}</span>
        `;

        div.addEventListener("click", () => {
          mainSource.src = `http://localhost:3000/uploads/${v.video}`;
          mainVideo.load();
          mainVideo.play();
        });

        videoListDiv.appendChild(div);
      });

      // İlk videonu avtomatik aç
      if(videos.length > 0){
        mainSource.src = `http://localhost:3000/uploads/${videos[0].video}`;
        mainVideo.load();
      }
    }

    loadVideos();
  </script>
</body>
</html>
